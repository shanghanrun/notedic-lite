import{f as _,a as x,c as J}from"./p1Lr3AEA.js";import"./Dy5oeoFD.js";import{C as y,D as ie,i as d,E as k,aH as D,p as V,s as v,t as j,a as Y,c as n,r as o,A as L,f as Z,aI as le}from"./Bo_w5O8x.js";import{s as R}from"./B5dKWiVt.js";import{i as S}from"./CcfPT99S.js";import{m as ne,P as N,T as K,a as oe,F as ce,e as he,i as de,b as ue}from"./DOGJSLat.js";import{t as ve,s as pe}from"./CID-vtnQ.js";import{a as X,r as ee,b as fe}from"./yS19KLYK.js";import{d as te}from"./DCTSnbhe.js";import{i as ge}from"./CF2St8gB.js";import{p as me}from"./BeW2ITSc.js";import{g as G}from"./B8Aw_0XD.js";class be{type="local";#e=y(ie([]));get files(){return d(this.#e)}set files(e){k(this.#e,e,!0)}#t=y("");get searchQuery(){return d(this.#t)}set searchQuery(e){k(this.#t,e,!0)}#s=y("");get searchFileQuery(){return d(this.#s)}set searchFileQuery(e){k(this.#s,e,!0)}#a=y(0);get scrollTop(){return d(this.#a)}set scrollTop(e){k(this.#a,e,!0)}#r=y(760);get containerHeight(){return d(this.#r)}set containerHeight(e){k(this.#r,e,!0)}#i=y(180);get itemHeight(){return d(this.#i)}set itemHeight(e){k(this.#i,e,!0)}#l=D(()=>{const e=this.searchQuery.trim();if(!e)return{regex:null,colorMap:new Map};const s=[...new Set(e.split("/").map(r=>r.trim()).filter(Boolean))],t=new Map;s.forEach((r,i)=>t.set(r.toLowerCase(),i));const a=s.sort((r,i)=>i.length-r.length).map(r=>r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|");return{regex:new RegExp(`(${a})`,"gi"),colorMap:t,queries:s}});get searchState(){return d(this.#l)}set searchState(e){k(this.#l,e)}#n=D(()=>{const{queries:e}=this.searchState;if(!e||e.length===0)return[];const s=[];return this.files.forEach(t=>{!t.checked||!t.lines||t.lines.forEach((a,r)=>{if(e.some(i=>a.includes(i))){const i=e.length>1&&e.every(l=>a.includes(l));s.push({id:`${t.name}-${r}`,fileName:t.name,text:a,lineIndex:r,isAndMatch:i})}})}),s.sort((t,a)=>a.isAndMatch-t.isAndMatch)});get searchResults(){return d(this.#n)}set searchResults(e){k(this.#n,e)}#o=D(()=>{const e=this.searchResults;if(e.length===0)return[];const s=Math.max(0,Math.floor(this.scrollTop/this.itemHeight)-2),t=Math.min(e.length,Math.ceil(this.containerHeight/this.itemHeight)+s+3);return e.slice(s,t).map((a,r)=>({...a,uniqueKey:`card-${a.id}`,renderTop:(s+r)*this.itemHeight}))});get visibleResults(){return d(this.#o)}set visibleResults(e){k(this.#o,e)}get totalHeight(){return this.searchResults.length*this.itemHeight}toggleFileCheck(e){this.files[e].checked=!this.files[e].checked,this.files=[...this.files],console.log(`íŒŒì¼ ì²´í¬ ë³€ê²½: ${this.files[e].name} -> ${this.files[e].checked}`)}highlightText=(e,s=!1)=>{const{regex:t,colorMap:a}=this.searchState;if(!e||!t)return e;const r=s?["#0000FF","#FF0000","#2ecc71","#e67e22"]:["#fde047","#ffcfdf","#d1fae5","#e0e7ff"];return e.replace(t,i=>{const l=i.toLowerCase(),p=a.has(l)?a.get(l):0,c=r[p%r.length];return s?`<b style="color: ${c}; font-weight: bold;">${i}</b>`:`<mark style="background-color: ${c} !important; color: black; border-radius: 2px; padding: 0 2px;">${i}</mark>`})};copyToClipboard(){const e=this.groupedResults,s=Object.entries(e);if(s.length===0){alert("ë³µì‚¬í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");return}let t=`ê²€ìƒ‰ì–´ [${this.searchQuery}] ë¶„ì„ ê²°ê³¼

`,a=`<div style="font-family: 'ë§‘ì€ ê³ ë”•', sans-serif; line-height: 1.6; margin:0; padding:0;">`;a+=`<h2 style="margin-bottom:20px;">ê²€ìƒ‰ì–´ [${this.searchQuery}] ë¶„ì„ ê²°ê³¼</h2>`;for(const[p,c]of s)t+=`[ì¶œì²˜: ${p}] (ì´ ${c.length}ê±´)
`,a+=`<div style="color: #2563eb; font-weight: bold; font-size: 1.2em; margin-top: 20px; margin-bottom: 10px;">[ì¶œì²˜: ${p}] (ì´ ${c.length}ê±´)</div>`,c.forEach(b=>{t+=`â—‹ ${b}

`,a+=`<div style="margin: 0 0 15px 0; padding: 0; text-indent: 0;">â—‹ ${this.highlightText(b,!0)}</div>`}),t+=`--------------------------

`,a+='<div style="border-top: 1px solid #eee; margin: 20px 0;"></div>';a+="</div>";const r="text/html",i=new Blob([a],{type:r}),l=[new ClipboardItem({[r]:i,"text/plain":new Blob([t],{type:"text/plain"})})];navigator.clipboard.write(l).then(()=>{alert("ë³´ê³ ì„œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (ì›í•˜ëŠ” íŒŒì¼ì— ë¶™ì—¬ ë„£ìœ¼ì„¸ìš”)")}).catch(p=>{console.error("ë³µì‚¬ ì‹¤íŒ¨:",p),navigator.clipboard.writeText(t)})}handleScroll=e=>{this.scrollTop=e.target.scrollTop};handleFileUpload=async e=>{const s=Array.from(e.target.files);let t=[];for(const a of s){const r=a.name.endsWith(".docx"),i=a.name.endsWith(".txt");if(!(!r&&!i))try{let l=r?(await ne.extractRawText({arrayBuffer:await a.arrayBuffer()})).value:await a.text();if(l){const p=l.split(/\r?\n/).map(c=>c.trim()).filter(c=>c!=="");t.push({name:a.name,lines:p,checked:!0})}}catch(l){console.error(l)}}this.files=[...this.files,...t],e.target.value=""};get groupedResults(){const e=this.searchResults;return!e||e.length===0?{}:e.reduce((s,t)=>(s[t.fileName]||(s[t.fileName]=[]),s[t.fileName].push(t.text),s),{})}reset(){this.files=[],this.searchQuery="",this.scrollTop=0}clearFiles=()=>{this.reset();const e=document.querySelector('input[type="file"]');e&&(e.value=""),console.log("ëª¨ë“  íŒŒì¼ ë° ê²€ìƒ‰ì–´ ì´ˆê¸°í™” ì™„ë£Œ")};async saveAsDocx(){if(!this.searchResults.length)return;const e=[new N({children:[new K({text:this.searchQuery,bold:!0})]})];Object.entries(this.groupedResults).forEach(([a,r])=>{e.push(new N({children:[new K({text:`[${a}]`,bold:!0})]})),r.forEach(i=>e.push(new N(i)))});const s=await oe.toBlob(new ce({sections:[{children:e}]})),t=document.createElement("a");t.href=URL.createObjectURL(s),t.download=`${this.searchQuery}.docx`,t.click()}}const u=new be;var ke=_('<button class="clear-text-btn svelte-11bskkd">[ì¼ê´„ì·¨ì†Œ]</button>'),xe=_('<div><div class="item-main svelte-11bskkd"><input type="checkbox" class="custom-checkbox svelte-11bskkd"/> <span class="filename svelte-11bskkd"> </span></div> <div class="file-info-tag svelte-11bskkd"> </div></div>'),_e=_('<div class="empty-state svelte-11bskkd"><p style="font-weight: 300; color: blue">íŒŒì¼ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.</p></div>'),ye=_('<aside class="col sidebar svelte-11bskkd"><header class="sidebar-header svelte-11bskkd"><h3 class="main-title svelte-11bskkd">ğŸ“‚ íŒŒì¼ ì„í¬íŠ¸</h3> <span class="count-badge svelte-11bskkd"> </span></header> <div class="file-input-wrapper"><label class="custom-file-btn svelte-11bskkd">ğŸ“„ ê²€ìƒ‰í•  íŒŒì¼ ì¶”ê°€ (docx, txt) <input type="file" multiple class="svelte-11bskkd"/></label> <p class="hint svelte-11bskkd">ë‹¤ì¤‘ ì„ íƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p></div> <div class="divider svelte-11bskkd"></div> <section class="file-panel svelte-11bskkd"><div class="panel-header svelte-11bskkd"><h4 class="sidebar-sub-title svelte-11bskkd">âš¡ ì„ íƒëœ íŒŒì¼ ëª©ë¡</h4> <!></div> <div class="file-list-container svelte-11bskkd"><!></div></section> <button> </button></aside>');function Be($,e){V(e,!1),ge();var s=ye(),t=n(s),a=v(n(t),2),r=n(a);o(a),o(t);var i=v(t,2),l=n(i),p=v(n(l));p.__change=function(...h){u.handleFileUpload?.apply(this,h)},o(l),L(2),o(i);var c=v(i,4),b=n(c),F=v(n(b),2);{var M=h=>{var m=ke();m.__click=function(...U){u.clearFiles?.apply(this,U)},x(h,m)};S(F,h=>{u.files.length>0&&h(M)})}o(b);var T=v(b,2),I=n(T);{var E=h=>{var m=J(),U=Z(m);he(U,1,()=>u.files,de,(se,w,O)=>{var q=xe();let P;q.__click=()=>u.toggleFileCheck(O);var A=n(q),Q=n(A);ee(Q),Q.__click=B=>{B.stopImmediatePropagation(),u.toggleFileCheck(O)};var W=v(Q,2),ae=n(W,!0);o(W),o(A);var z=v(A,2),re=n(z);o(z),o(q),j(B=>{P=X(q,1,"indexing-item-card svelte-11bskkd",null,P,{"is-selected":d(w).checked,unselected:!d(w).checked}),fe(Q,d(w).checked),R(ae,B),R(re,`${(d(w).lines?.length||0)??""} lines`)},[()=>d(w).name.replace(".docx","").replace(".txt","")]),x(se,q)}),x(h,m)},f=h=>{var m=_e();ve(3,m,()=>pe),x(h,m)};S(I,h=>{u.files.length>0?h(E):h(f,!1)})}o(T),o(c);var g=v(c,2);let H;g.__click=()=>u.saveAsDocx();var C=n(g,!0);o(g),o(s),j(()=>{R(r,`íŒŒì¼ ìˆ˜: ${u.files.length??""}`),H=X(g,1,"export-btn svelte-11bskkd",null,H,{active:u.searchResults.length>0}),g.disabled=u.searchResults.length===0,R(C,u.searchResults.length>0?`ğŸ“„ ê²°ê³¼ DOCX ì €ì¥ (${u.searchResults.length}ê±´)`:"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤")}),x($,s),Y()}te(["change","click"]);var we=_('<button class="go-button svelte-5qk8qx">ê¸°ì¡´ìë£Œ ê²€ìƒ‰</button>'),qe=_('<button class="go-button svelte-5qk8qx">Home</button>'),Re=_('<div class="search-header svelte-5qk8qx"><div class="search-container svelte-5qk8qx"><div class="main-search-group svelte-5qk8qx"><input type="text" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (ì˜ˆ: æ°£/è¡€)" class="search-input svelte-5qk8qx"/> <button class="search-button svelte-5qk8qx">ê²€ìƒ‰</button></div> <div class="sub-action-group svelte-5qk8qx"><div class="info-badge svelte-5qk8qx">ë§¤ì¹­: <span class="match-count svelte-5qk8qx"> </span>ê±´</div> <!> <a href="https://music.chois.cloud" class="music-link svelte-5qk8qx">ìŒì•…ê°ìƒ <span class="icon">&rarr;</span></a></div></div></div>');function De($,e){V(e,!0);let s=me(e,"item",7),t=s().type;var a=Re(),r=n(a),i=n(r),l=n(i);ee(l),l.__keydown=f=>f.key==="Enter"&&s().startSearch(),le(l);var p=v(l,2);p.__click=()=>s().startSearch(),o(i);var c=v(i,2),b=n(c),F=v(n(b)),M=n(F,!0);o(F),L(),o(b);var T=v(b,2);{var I=f=>{var g=we();g.__click=()=>{s().reset(),G("/admin")},x(f,g)},E=f=>{var g=J(),H=Z(g);{var C=h=>{var m=qe();m.__click=()=>{s().reset(),G("/")},x(h,m)};S(H,h=>{t==="server"&&h(C)},!0)}x(f,g)};S(T,f=>{t==="local"?f(I):f(E,!1)})}L(2),o(c),o(r),o(a),j(()=>R(M,s().searchResults.length)),ue(l,()=>s().searchQuery,f=>s().searchQuery=f),x($,a),Y()}te(["keydown","click"]);export{Be as S,De as U,u as s};
